library("dplyr")

setwd("~/H_BB_RRBS/rawdata/01_trim/02_align_wg/03_extract_meth_R")

list.files(pattern = ".bismark10.txt$")

# [1] "BH_CF01_1_val_1_bismark_bt2_pe.bismark10.txt"
# [2] "BH_CF02_1_val_1_bismark_bt2_pe.bismark10.txt"
# [3] "BH_CF03_1_val_1_bismark_bt2_pe.bismark10.txt"
# [4] "BH_CF04_1_val_1_bismark_bt2_pe.bismark10.txt"
# [5] "BH_CF05_1_val_1_bismark_bt2_pe.bismark10.txt"
# [6] "BH_CF06_1_val_1_bismark_bt2_pe.bismark10.txt"
# [7] "BH_CF07_1_val_1_bismark_bt2_pe.bismark10.txt"
# [8] "BH_CF08_1_val_1_bismark_bt2_pe.bismark10.txt"
# [9] "BH_CF09_1_val_1_bismark_bt2_pe.bismark10.txt"
# [10] "BH_CF10_1_val_1_bismark_bt2_pe.bismark10.txt"
# [11] "BH_CF11_1_val_1_bismark_bt2_pe.bismark10.txt"
# [12] "BH_CF12_1_val_1_bismark_bt2_pe.bismark10.txt"
# [13] "BH_CF13_1_val_1_bismark_bt2_pe.bismark10.txt"
# [14] "BH_CF14_1_val_1_bismark_bt2_pe.bismark10.txt"
# [15] "BH_CF15_1_val_1_bismark_bt2_pe.bismark10.txt"
# [16] "BH_CF16_1_val_1_bismark_bt2_pe.bismark10.txt"
# [17] "BH_CF17_1_val_1_bismark_bt2_pe.bismark10.txt"
# [18] "BH_CFD01_1_val_1_bismark_bt2_pe.bismark10.txt"
# [19] "BH_CFD02_1_val_1_bismark_bt2_pe.bismark10.txt"
# [20] "BH_CFD03_1_val_1_bismark_bt2_pe.bismark10.txt"
# [21] "BH_CFD04_1_val_1_bismark_bt2_pe.bismark10.txt"
# [22] "BH_CM01_1_val_1_bismark_bt2_pe.bismark10.txt"
# [23] "BH_CM02_1_val_1_bismark_bt2_pe.bismark10.txt"
# [24] "BH_CM03_1_val_1_bismark_bt2_pe.bismark10.txt"
# [25] "BH_CM04_1_val_1_bismark_bt2_pe.bismark10.txt"
# [26] "BH_CM05_1_val_1_bismark_bt2_pe.bismark10.txt"
# [27] "BH_CM06_1_val_1_bismark_bt2_pe.bismark10.txt"
# [28] "BH_CM07_1_val_1_bismark_bt2_pe.bismark10.txt"
# [29] "BH_CM08_1_val_1_bismark_bt2_pe.bismark10.txt"
# [30] "BH_CM09_1_val_1_bismark_bt2_pe.bismark10.txt"
# [31] "BH_CM10_1_val_1_bismark_bt2_pe.bismark10.txt"
# [32] "BH_CM11_1_val_1_bismark_bt2_pe.bismark10.txt"
# [33] "BH_CM12_1_val_1_bismark_bt2_pe.bismark10.txt"
# [34] "BH_CM13_1_val_1_bismark_bt2_pe.bismark10.txt"
# [35] "BH_CM14_1_val_1_bismark_bt2_pe.bismark10.txt"
# [36] "BH_CM15_1_val_1_bismark_bt2_pe.bismark10.txt"
# [37] "BH_CM16_1_val_1_bismark_bt2_pe.bismark10.txt"
# [38] "BH_CM17_1_val_1_bismark_bt2_pe.bismark10.txt"
# [39] "BH_CM18_1_val_1_bismark_bt2_pe.bismark10.txt"
# [40] "BH_CM19_1_val_1_bismark_bt2_pe.bismark10.txt"
# [41] "BH_CM20_1_val_1_bismark_bt2_pe.bismark10.txt"
# [42] "BH_CM21_1_val_1_bismark_bt2_pe.bismark10.txt"
# [43] "BH_CM22_1_val_1_bismark_bt2_pe.bismark10.txt"
# [44] "BH_CM23_1_val_1_bismark_bt2_pe.bismark10.txt"
# [45] "BH_CM24_1_val_1_bismark_bt2_pe.bismark10.txt"
# [46] "BH_CM25_1_val_1_bismark_bt2_pe.bismark10.txt"
# [47] "BH_CM26_1_val_1_bismark_bt2_pe.bismark10.txt"
# [48] "BH_CM27_1_val_1_bismark_bt2_pe.bismark10.txt"
# [49] "BH_CM28_1_val_1_bismark_bt2_pe.bismark10.txt"
# [50] "BH_CM29_1_val_1_bismark_bt2_pe.bismark10.txt"
# [51] "BH_CM30_1_val_1_bismark_bt2_pe.bismark10.txt"
# [52] "BH_CM31_1_val_1_bismark_bt2_pe.bismark10.txt"
# [53] "BH_CM32_1_val_1_bismark_bt2_pe.bismark10.txt"
# [54] "BH_CM33_1_val_1_bismark_bt2_pe.bismark10.txt"
# [55] "BH_CM34_1_val_1_bismark_bt2_pe.bismark10.txt"
# [56] "BH_CM35_1_val_1_bismark_bt2_pe.bismark10.txt"
# [57] "BH_CM36_1_val_1_bismark_bt2_pe.bismark10.txt"
# [58] "BH_CM37_1_val_1_bismark_bt2_pe.bismark10.txt"
# [59] "BH_CM38_1_val_1_bismark_bt2_pe.bismark10.txt"
# [60] "BH_CM39_1_val_1_bismark_bt2_pe.bismark10.txt"
# [61] "BH_CM40_1_val_1_bismark_bt2_pe.bismark10.txt"
# [62] "BH_CM41_1_val_1_bismark_bt2_pe.bismark10.txt"
# [63] "BH_CM42_1_val_1_bismark_bt2_pe.bismark10.txt"
# [64] "BH_CM43_1_val_1_bismark_bt2_pe.bismark10.txt"
# [65] "BH_CM44_1_val_1_bismark_bt2_pe.bismark10.txt"
# [66] "BH_CM45_1_val_1_bismark_bt2_pe.bismark10.txt"
# [67] "BH_CM46_1_val_1_bismark_bt2_pe.bismark10.txt"
# [68] "BH_CM47_1_val_1_bismark_bt2_pe.bismark10.txt"
# [69] "BH_CM48_1_val_1_bismark_bt2_pe.bismark10.txt"
# [70] "BH_CM49_1_val_1_bismark_bt2_pe.bismark10.txt"
# [71] "BH_CM50_1_val_1_bismark_bt2_pe.bismark10.txt"
# [72] "BH_CM51_1_val_1_bismark_bt2_pe.bismark10.txt"
# [73] "BH_CM52_1_val_1_bismark_bt2_pe.bismark10.txt"
# [74] "BH_CM53_1_val_1_bismark_bt2_pe.bismark10.txt"
# [75] "BH_CM54_1_val_1_bismark_bt2_pe.bismark10.txt"
# [76] "BH_CM55_1_val_1_bismark_bt2_pe.bismark10.txt"
# [77] "BH_CM56_1_val_1_bismark_bt2_pe.bismark10.txt"
# [78] "BH_CM57_1_val_1_bismark_bt2_pe.bismark10.txt"
# [79] "BH_CM58_1_val_1_bismark_bt2_pe.bismark10.txt"
# [80] "BH_CM59_1_val_1_bismark_bt2_pe.bismark10.txt"
# [81] "BH_CM60_1_val_1_bismark_bt2_pe.bismark10.txt"
# [82] "BH_CM61_1_val_1_bismark_bt2_pe.bismark10.txt"
# [83] "BH_CM62_1_val_1_bismark_bt2_pe.bismark10.txt"
# [84] "BH_CM63_1_val_1_bismark_bt2_pe.bismark10.txt"
# [85] "BH_CM64_1_val_1_bismark_bt2_pe.bismark10.txt"
# [86] "BH_CM65_1_val_1_bismark_bt2_pe.bismark10.txt"
# [87] "BH_CM66_1_val_1_bismark_bt2_pe.bismark10.txt"
# [88] "BH_CM67_1_val_1_bismark_bt2_pe.bismark10.txt"
# [89] "BH_CM68_1_val_1_bismark_bt2_pe.bismark10.txt"
# [90] "BH_CM69_1_val_1_bismark_bt2_pe.bismark10.txt"
# [91] "BH_CM70_1_val_1_bismark_bt2_pe.bismark10.txt"
# [92] "BH_CM71_1_val_1_bismark_bt2_pe.bismark10.txt"
# [93] "BH_CM72_1_val_1_bismark_bt2_pe.bismark10.txt"
# [94] "BH_CM73_1_val_1_bismark_bt2_pe.bismark10.txt"
# [95] "BH_CM74_1_val_1_bismark_bt2_pe.bismark10.txt"
# [96] "BH_CM75_1_val_1_bismark_bt2_pe.bismark10.txt"
# [97] "BH_CM76_1_val_1_bismark_bt2_pe.bismark10.txt"
# [98] "BH_CM77_1_val_1_bismark_bt2_pe.bismark10.txt"
# [99] "BH_CM78_1_val_1_bismark_bt2_pe.bismark10.txt"
# [100] "BH_CM79_1_val_1_bismark_bt2_pe.bismark10.txt"
# [101] "BH_CM80_1_val_1_bismark_bt2_pe.bismark10.txt"
# [102] "BH_CM81_1_val_1_bismark_bt2_pe.bismark10.txt"

## 1. 各ファイルから site と rate を抽出 → meth_list 作成
# .bismark10.txt ファイルを取得
files <- list.files(pattern = ".bismark10.txt$")

# 各ファイルごとに site（CpGの位置）と rate（メチル化率）のデータフレームを作成
meth_list <- lapply(files, function(file) {
  df <- read.table(file, header = FALSE, sep = "\t")  # 区切りはタブ
  rate <- df[, 4]  # 第4列がメチル化率
  site <- paste(df[, 1], df[, 2], sep = "_")  # 第1列（chr）と第2列（start）を結合
  data.frame(site = site, rate = rate)
})

# 各リスト要素にファイル名（拡張子なし）を名前として付ける
names(meth_list) <- sub("_1_val_1_bismark_bt2_pe.bismark10.txt", "", files)

## 2. meth_list を site でマージ → meth_merged
# 各サンプルのデータを site 列で結合して1つのデータフレームに
meth_merged <- Reduce(function(x, y) merge(x, y, by = "site", all = TRUE), meth_list)

# カラム名を調整（1列目はsite、それ以外はサンプル名にする）
colnames(meth_merged) <- c("site", names(meth_list))
#※ 上記の colnames() の使い方は、meth_listの順序を信頼できる場合のみ有効です。

# meth_list を保存しておくと再読み込みが速い
saveRDS(meth_list, file = "meth_list.rds")

# 統合データも保存しておく
write.table(meth_merged, file = "meth_merged.tsv", sep = "\t", quote = FALSE, row.names = FALSE)

#ここまでデータ整備、読み込むには以下
meth_list <- readRDS("meth_list.rds")
meth_merged <- read.table("meth_merged.tsv", header = TRUE, sep = "\t", stringsAsFactors = FALSE)

#ちなみに
str(meth_merged)  
# 'data.frame':   8938086 obs. of  103 variables:
#   $ site    : chr  "NC_003427.1_10003" "NC_003427.1_10004" "NC_003427.1_10026" "NC_003427.1_10027" ...
# $ BH_CF01 : num  NA NA NA NA NA NA NA NA NA NA ...
# $ BH_CF02 : num  NA NA NA NA NA 0 NA 0 NA 0 ...
# $ BH_CF03 : num  NA NA NA NA NA 0 NA 0 NA 0 ...
# $ BH_CF04 : num  NA 2.94 NA 5.88 NA ...
# $ BH_CF05 : num  0 0 0 0 0 ...
# $ BH_CF06 : num  NA 0 NA 0 0 0 0 0 0 0 ...
# $ BH_CF07 : num  NA 0 NA 3.7 NA ...
# $ BH_CF08 : num  NA 0 0 0 0 ...
# $ BH_CF09 : num  0 0 0 0 0 0 0 0 0 0 ...
# $ BH_CF10 : num  NA 0 NA 0 0 0 20 0 0 0 ...
# $ BH_CF11 : num  0 0 0 0 0 ...
# $ BH_CF12 : num  0 0 0 0 0 0 0 0 0 0 ...
# $ BH_CF13 : num  NA 0 0 2.17 0 ...
# $ BH_CF14 : num  NA 2 NA 0 0 ...
# $ BH_CF15 : num  NA 0 0 0 0 0 0 0 0 0 ...
# $ BH_CF16 : num  0 0 0 0 0 0 0 0 0 0 ...
# $ BH_CF17 : num  NA 0 0 0 0 ...
# $ BH_CFD01: num  0 0 0 0 0 ...
# $ BH_CFD02: num  NA 0 NA 5.13 0 ...
# $ BH_CFD03: num  NA NA NA 0 NA ...
# $ BH_CFD04: num  NA 0 NA 0 NA ...
# $ BH_CM01 : num  NA NA NA NA 0 0 0 0 0 0 ...
# $ BH_CM02 : num  NA 0 NA 0 0 0 0 0 0 0 ...
# $ BH_CM03 : num  NA NA NA NA NA 0 0 0 0 0 ...
# $ BH_CM04 : num  NA 0 NA 0 NA 0 NA 0 NA 0 ...
# $ BH_CM05 : num  NA 0 NA 0 NA ...
# $ BH_CM06 : num  0 7.41 0 0 0 ...
# $ BH_CM07 : num  0 0 0 0 0 0 0 0 0 0 ...
# $ BH_CM08 : num  NA 0 NA 5.26 NA ...
# $ BH_CM09 : num  NA 0 0 0 0 ...
# $ BH_CM10 : num  NA NA NA NA NA 0 0 0 0 0 ...
# $ BH_CM11 : num  NA 0 NA 0 0 ...
# $ BH_CM12 : num  0 0 0 0 0 0 0 0 0 0 ...
# $ BH_CM13 : num  0 0 0 0 0 ...
# $ BH_CM14 : num  NA 0 NA 0 0 ...
# $ BH_CM15 : num  0 0 0 0 0 ...
# $ BH_CM16 : num  5.88 0 0 0 0 ...
# $ BH_CM17 : num  0 0 0 0 0 ...
# $ BH_CM18 : num  0 0 7.69 0 3.23 ...
# $ BH_CM19 : num  NA NA NA NA NA 0 NA 0 NA 0 ...
# $ BH_CM20 : num  0 0 0 0 0 ...
# $ BH_CM21 : num  NA 0 NA 0 0 ...
# $ BH_CM22 : num  0 3.92 0 0 0 ...
# $ BH_CM23 : num  0 4.65 0 0 0 ...
# $ BH_CM24 : num  0 0 0 0 0 ...
# $ BH_CM25 : num  NA 0 NA 0 0 0 0 0 0 0 ...
# $ BH_CM26 : num  11.8 0 0 0 0 ...
# $ BH_CM27 : num  NA 6.06 NA 0 0 ...
# $ BH_CM28 : num  0 0 0 0 15.4 ...
# $ BH_CM29 : num  NA 0 NA 0 0 0 0 0 0 0 ...
# $ BH_CM30 : num  0 0 0 0 0 0 0 0 0 0 ...
# $ BH_CM31 : num  NA 0 0 0 0 0 0 0 0 0 ...
# $ BH_CM32 : num  0 0 0 0 0 0 0 0 0 0 ...
# $ BH_CM33 : num  NA 0 0 0 0 ...
# $ BH_CM34 : num  0 0 0 0 0 ...
# $ BH_CM35 : num  0 0 0 2.94 0 ...
# $ BH_CM36 : num  0 NA 0 0 0 0 0 0 0 0 ...
# $ BH_CM37 : num  0 0 0 5.41 0 ...
# $ BH_CM38 : num  NA 0 NA 0 0 0 0 0 0 0 ...
# $ BH_CM39 : num  5.88 0 0 0 0 ...
# $ BH_CM40 : num  0 0 0 0 0 0 0 0 0 0 ...
# $ BH_CM41 : num  0 0 0 0 0 0 0 0 0 0 ...
# $ BH_CM42 : num  NA 0 NA 0 0 ...
# $ BH_CM43 : num  NA 0 NA 0 NA 0 0 0 0 0 ...
# $ BH_CM44 : num  NA NA NA NA 0 0 0 0 0 0 ...
# $ BH_CM45 : num  0 0 0 0 0 ...
# $ BH_CM46 : num  NA NA NA 0 0 0 0 0 0 0 ...
# $ BH_CM47 : num  NA 0 NA 0 0 0 0 0 0 0 ...
# $ BH_CM48 : num  NA NA NA 0 0 ...
# $ BH_CM49 : num  NA 17.6 NA 0 0 ...
# $ BH_CM50 : num  NA 0 NA 0 NA 0 NA 0 NA 0 ...
# $ BH_CM51 : num  NA 0 NA 0 0 0 0 0 0 0 ...
# $ BH_CM52 : num  NA 0 NA 0 0 0 0 0 0 0 ...
# $ BH_CM53 : num  0 NA 0 0 0 0 0 0 0 0 ...
# $ BH_CM54 : num  NA 0 NA 0 15.4 ...
# $ BH_CM55 : num  0 0 0 0 0 0 0 0 0 0 ...
# $ BH_CM56 : num  NA 0 NA 0 0 0 0 0 0 0 ...
# $ BH_CM57 : num  0 0 0 0 0 0 0 0 0 0 ...
# $ BH_CM58 : num  NA NA NA 0 NA 0 NA 0 NA 0 ...
# $ BH_CM59 : num  NA NA NA 0 NA 0 NA 0 0 0 ...
# $ BH_CM60 : num  NA 0 NA 0 0 0 0 0 0 0 ...
# $ BH_CM61 : num  NA NA NA 0 NA 0 0 0 NA 0 ...
# $ BH_CM62 : num  NA 0 NA 0 0 0 0 0 NA 0 ...
# $ BH_CM63 : num  NA 0 NA 0 0 0 0 0 0 0 ...
# $ BH_CM64 : num  NA 0 NA 0 0 ...
# $ BH_CM65 : num  NA 0 NA 0 0 0 0 0 0 0 ...
# $ BH_CM66 : num  NA 0 NA 0 0 ...
# $ BH_CM67 : num  0 0 0 0 0 0 0 0 0 1 ...
# $ BH_CM68 : num  NA 0 0 0 0 ...
# $ BH_CM69 : num  NA 0 NA 5 0 0 0 0 0 0 ...
# $ BH_CM70 : num  NA 0 NA 7.14 0 ...
# $ BH_CM71 : num  NA 0 NA 0 0 0 0 0 0 0 ...
# $ BH_CM72 : num  0 0 0 0 0 0 0 0 0 0 ...
# $ BH_CM73 : num  NA 0 0 0 0 ...
# $ BH_CM74 : num  0 0 0 0 5.41 ...
# $ BH_CM75 : num  NA 0 NA 0 0 0 0 0 NA 0 ...
# $ BH_CM76 : num  NA 0 NA 0 0 0 0 0 0 0 ...
# $ BH_CM77 : num  0 0 0 0 0 ...
# [list output truncated]

str(meth_list)
# List of 102
# $ BH_CF01 :'data.frame':       438189 obs. of  2 variables:
#   ..$ site: chr [1:438189] "NW_026622919.1_24317" "NW_026622919.1_24319" "NW_026622919.1_129846" "NW_026622919.1_129848" ...
# ..$ rate: num [1:438189] 62.5 100 100 100 100 ...
# $ BH_CF02 :'data.frame':       436882 obs. of  2 variables:
#   ..$ site: chr [1:436882] "NW_026622985.1_1112" "NW_026622985.1_1115" "NW_026622985.1_10254" "NW_026622985.1_10428" ...
# ..$ rate: num [1:436882] 100 100 85.7 92.9 100 ...
# $ BH_CF03 :'data.frame':       2023022 obs. of  2 variables:
#   ..$ site: chr [1:2023022] "NW_026622897.1_3003" "NW_026622897.1_3841" "NW_026622897.1_3911" "NW_026622897.1_3918" ...
# ..$ rate: num [1:2023022] 100 100 100 100 100 ...
# $ BH_CF04 :'data.frame':       161941 obs. of  2 variables:
#   ..$ site: chr [1:161941] "NW_026622985.1_20729" "NW_026622985.1_20740" "NW_026622985.1_20743" "NW_026622985.1_23594" ...
# ..$ rate: num [1:161941] 100 100 100 20.8 100 ...
# $ BH_CF05 :'data.frame':       1657399 obs. of  2 variables:
#   ..$ site: chr [1:1657399] "NW_026622875.1_19241" "NW_026622875.1_19284" "NW_026622875.1_19318" "NW_026622875.1_19335" ...
# ..$ rate: num [1:1657399] 100 91.7 100 100 91.7 ...
# $ BH_CF06 :'data.frame':       1337295 obs. of  2 variables:
#   ..$ site: chr [1:1337295] "NW_026622874.1_11763" "NW_026622874.1_11809" "NW_026622874.1_25163" "NW_026622874.1_25170" ...
# ..$ rate: num [1:1337295] 100 87.5 100 100 0 ...
# $ BH_CF07 :'data.frame':       1854930 obs. of  2 variables:
#   ..$ site: chr [1:1854930] "NW_026622930.1_42327" "NW_026622930.1_42343" "NW_026622930.1_46978" "NW_026622930.1_47073" ...
# ..$ rate: num [1:1854930] 0 40 100 87.5 69.2 ...
# $ BH_CF08 :'data.frame':       1715163 obs. of  2 variables:
#   ..$ site: chr [1:1715163] "NW_026622863.1_2521" "NW_026622863.1_2528" "NW_026622863.1_2539" "NW_026622863.1_2595" ...
# ..$ rate: num [1:1715163] 90.9 100 90.9 63.6 72.7 ...
# $ BH_CF09 :'data.frame':       2045856 obs. of  2 variables:
#   ..$ site: chr [1:2045856] "NW_026623056.1_375" "NW_026623056.1_396" "NW_026623056.1_516" "NW_026623056.1_519" ...
# ..$ rate: num [1:2045856] 84.6 23.1 96 100 100 ...
# $ BH_CF10 :'data.frame':       1717180 obs. of  2 variables:
#   ..$ site: chr [1:1717180] "NW_026622941.1_1824" "NW_026622941.1_1936" "NW_026622941.1_1939" "NW_026622941.1_2117" ...
# ..$ rate: num [1:1717180] 0 55.6 100 16.7 100 ...
# $ BH_CF11 :'data.frame':       2126945 obs. of  2 variables:
#   ..$ site: chr [1:2126945] "NW_026623030.1_675" "NW_026623030.1_849" "NW_026623030.1_859" "NW_026623030.1_4695" ...
# ..$ rate: num [1:2126945] 100 78.9 94.7 55.6 44.4 ...
# $ BH_CF12 :'data.frame':       1253726 obs. of  2 variables:
#   ..$ site: chr [1:1253726] "NW_026622808.1_13097" "NW_026622808.1_13108" "NW_026622808.1_13112" "NW_026622808.1_13141" ...
# ..$ rate: num [1:1253726] 69.2 100 50 91.7 100 ...
# $ BH_CF13 :'data.frame':       2004351 obs. of  2 variables:
#   ..$ site: chr [1:2004351] "NW_026623078.1_13329" "NW_026623078.1_13337" "NW_026623078.1_13338" "NW_026623078.1_13346" ...
# ..$ rate: num [1:2004351] 72.4 65.5 57.9 0 86.2 ...
# $ BH_CF14 :'data.frame':       1915090 obs. of  2 variables:
#   ..$ site: chr [1:1915090] "NW_026622897.1_3911" "NW_026622897.1_3918" "NW_026622897.1_3951" "NW_026622897.1_9236" ...
# ..$ rate: num [1:1915090] 100 100 100 100 75 ...
# $ BH_CF15 :'data.frame':       2126905 obs. of  2 variables:
#   ..$ site: chr [1:2126905] "NC_079873.1_13844" "NC_079873.1_13871" "NC_079873.1_13872" "NC_079873.1_13927" ...
# ..$ rate: num [1:2126905] 100 100 100 100 100 ...
# $ BH_CF16 :'data.frame':       2144590 obs. of  2 variables:
#   ..$ site: chr [1:2144590] "NW_026623078.1_13329" "NW_026623078.1_13337" "NW_026623078.1_13338" "NW_026623078.1_13469" ...
# ..$ rate: num [1:2144590] 64.6 62.4 76.5 89.4 100 ...
# $ BH_CF17 :'data.frame':       2258749 obs. of  2 variables:
#   ..$ site: chr [1:2258749] "NW_026622763.1_279" "NW_026622763.1_284" "NW_026622763.1_295" "NW_026622763.1_311" ...
# ..$ rate: num [1:2258749] 25 69.2 21.4 73.3 100 ...
# $ BH_CFD01:'data.frame':       1495145 obs. of  2 variables:
#   ..$ site: chr [1:1495145] "NW_026623030.1_1502" "NW_026623030.1_1523" "NW_026623030.1_1524" "NW_026623030.1_1603" ...
# ..$ rate: num [1:1495145] 72.3 21.3 23.3 97.9 88.5 ...
# $ BH_CFD02:'data.frame':       1378552 obs. of  2 variables:
#   ..$ site: chr [1:1378552] "NW_026623030.1_4695" "NW_026623030.1_4801" "NW_026623030.1_4819" "NW_026623030.1_5248" ...
# ..$ rate: num [1:1378552] 90.9 54.5 71.4 100 0 ...
# $ BH_CFD03:'data.frame':       1177589 obs. of  2 variables:
#   ..$ site: chr [1:1177589] "NW_026623078.1_13329" "NW_026623078.1_13337" "NW_026623078.1_13338" "NW_026623078.1_13346" ...
# ..$ rate: num [1:1177589] 68.3 47.5 62.3 0 96.7 ...
# $ BH_CFD04:'data.frame':       1609113 obs. of  2 variables:
#   ..$ site: chr [1:1609113] "NW_026623111.1_2454" "NW_026623111.1_32965" "NW_026623111.1_36753" "NW_026623111.1_38224" ...
# ..$ rate: num [1:1609113] 77.8 44.4 100 40 66.7 ...
# $ BH_CM01 :'data.frame':       1403912 obs. of  2 variables:
#   ..$ site: chr [1:1403912] "NW_026622941.1_1667" "NW_026622941.1_2117" "NW_026622941.1_2135" "NW_026622941.1_2145" ...
# ..$ rate: num [1:1403912] 16.7 84.6 100 100 86.7 ...
# $ BH_CM02 :'data.frame':       1019879 obs. of  2 variables:
#   ..$ site: chr [1:1019879] "NW_026622819.1_47129" "NW_026622819.1_47131" "NW_026622819.1_47152" "NW_026622819.1_47164" ...
# ..$ rate: num [1:1019879] 83.3 100 100 66.7 100 ...
# $ BH_CM03 :'data.frame':       1751098 obs. of  2 variables:
#   ..$ site: chr [1:1751098] "NW_026622908.1_14228" "NW_026622908.1_14246" "NW_026622908.1_14256" "NW_026622908.1_14270" ...
# ..$ rate: num [1:1751098] 75 37.5 28.6 57.1 70.6 ...
# $ BH_CM04 :'data.frame':       442376 obs. of  2 variables:
#   ..$ site: chr [1:442376] "NW_026622963.1_22951" "NW_026622963.1_166714" "NW_026622963.1_166747" "NW_026622963.1_166779" ...
# ..$ rate: num [1:442376] 100 0 100 100 100 100 100 100 100 80 ...
# $ BH_CM05 :'data.frame':       1624685 obs. of  2 variables:
#   ..$ site: chr [1:1624685] "NW_026622875.1_19241" "NW_026622875.1_19284" "NW_026622875.1_19318" "NW_026622875.1_19335" ...
# ..$ rate: num [1:1624685] 100 75 100 100 100 ...
# $ BH_CM06 :'data.frame':       1500265 obs. of  2 variables:
#   ..$ site: chr [1:1500265] "NW_026622952.1_1810" "NW_026622952.1_1874" "NW_026622952.1_1882" "NW_026622952.1_2596" ...
# ..$ rate: num [1:1500265] 80 100 0 100 80 100 60 100 100 100 ...
# $ BH_CM07 :'data.frame':       1542906 obs. of  2 variables:
#   ..$ site: chr [1:1542906] "NW_026622908.1_16651" "NW_026622908.1_16825" "NW_026622908.1_16835" "NW_026622908.1_16861" ...
# ..$ rate: num [1:1542906] 46.2 23.1 23.1 76.9 23.1 ...
# $ BH_CM08 :'data.frame':       1151664 obs. of  2 variables:
#   ..$ site: chr [1:1151664] "NW_026622819.1_64952" "NW_026622819.1_73879" "NW_026622819.1_73916" "NW_026622819.1_73923" ...
# ..$ rate: num [1:1151664] 77.8 33.3 0 0 0 ...
# $ BH_CM09 :'data.frame':       1710318 obs. of  2 variables:
#   ..$ site: chr [1:1710318] "NW_026622863.1_7174" "NW_026622863.1_7251" "NW_026622863.1_7256" "NW_026622863.1_7294" ...
# ..$ rate: num [1:1710318] 80 71.9 78.1 37.5 83.3 ...
# $ BH_CM10 :'data.frame':       1254695 obs. of  2 variables:
#   ..$ site: chr [1:1254695] "NW_026622808.1_13097" "NW_026622808.1_13108" "NW_026622808.1_13112" "NW_026622808.1_13141" ...
# ..$ rate: num [1:1254695] 53.3 100 79.3 93.3 100 ...
# $ BH_CM11 :'data.frame':       1313272 obs. of  2 variables:
#   ..$ site: chr [1:1313272] "NW_026623100.1_62730" "NW_026623100.1_82888" "NW_026623100.1_82918" "NW_026623100.1_82930" ...
# ..$ rate: num [1:1313272] 28.6 100 91.8 100 93.4 ...
# $ BH_CM12 :'data.frame':       1660452 obs. of  2 variables:
#   ..$ site: chr [1:1660452] "NW_026622919.1_28917" "NW_026622919.1_28921" "NW_026622919.1_28935" "NW_026622919.1_28950" ...
# ..$ rate: num [1:1660452] 40 0 20 0 40 ...
# $ BH_CM13 :'data.frame':       2383463 obs. of  2 variables:
#   ..$ site: chr [1:2383463] "NW_026623078.1_13329" "NW_026623078.1_13330" "NW_026623078.1_13337" "NW_026623078.1_13338" ...
# ..$ rate: num [1:2383463] 68.3 33.3 67.1 66.2 0 ...
# $ BH_CM14 :'data.frame':       1765405 obs. of  2 variables:
#   ..$ site: chr [1:1765405] "NW_026623067.1_8166" "NW_026623067.1_8340" "NW_026623067.1_8350" "NW_026623067.1_8719" ...
# ..$ rate: num [1:1765405] 62.1 61.5 74.1 62.3 80 ...
# $ BH_CM15 :'data.frame':       2314977 obs. of  2 variables:
#   ..$ site: chr [1:2314977] "NW_026622874.1_11640" "NW_026622874.1_11653" "NW_026622874.1_11763" "NW_026622874.1_11809" ...
# ..$ rate: num [1:2314977] 100 33.3 96.3 75.9 100 ...
# $ BH_CM16 :'data.frame':       1395837 obs. of  2 variables:
#   ..$ site: chr [1:1395837] "NW_026622797.1_32095" "NW_026622797.1_32117" "NW_026622797.1_32162" "NW_026622797.1_32165" ...
# ..$ rate: num [1:1395837] 25 25 25 25 80 ...
# $ BH_CM17 :'data.frame':       1924935 obs. of  2 variables:
#   ..$ site: chr [1:1924935] "NW_026622786.1_16388" "NW_026622786.1_16419" "NW_026622786.1_16440" "NW_026622786.1_16452" ...
# ..$ rate: num [1:1924935] 100 80 0 100 100 100 100 100 100 100 ...
# $ BH_CM18 :'data.frame':       1931073 obs. of  2 variables:
#   ..$ site: chr [1:1931073] "NW_026622930.1_42327" "NW_026622930.1_42343" "NW_026622930.1_50329" "NW_026622930.1_50339" ...
# ..$ rate: num [1:1931073] 0 66.7 80 100 100 ...
# $ BH_CM19 :'data.frame':       1163125 obs. of  2 variables:
#   ..$ site: chr [1:1163125] "NW_026622819.1_47105" "NW_026622819.1_47128" "NW_026622819.1_47130" "NW_026622819.1_47151" ...
# ..$ rate: num [1:1163125] 100 100 100 33.3 83.3 ...
# $ BH_CM20 :'data.frame':       1915590 obs. of  2 variables:
#   ..$ site: chr [1:1915590] "NW_026623050.1_5331" "NW_026623050.1_5337" "NW_026623050.1_5340" "NW_026623050.1_5352" ...
# ..$ rate: num [1:1915590] 91.7 58.3 100 100 91.7 ...
# $ BH_CM21 :'data.frame':       2573721 obs. of  2 variables:
#   ..$ site: chr [1:2573721] "NW_026623100.1_62730" "NW_026623100.1_82888" "NW_026623100.1_82918" "NW_026623100.1_82930" ...
# ..$ rate: num [1:2573721] 85.7 100 100 95.5 100 ...
# $ BH_CM22 :'data.frame':       2112459 obs. of  2 variables:
#   ..$ site: chr [1:2112459] "NW_026623111.1_2454" "NW_026623111.1_32965" "NW_026623111.1_36754" "NW_026623111.1_36773" ...
# ..$ rate: num [1:2112459] 71.4 80 55.6 55.6 0 ...
# $ BH_CM23 :'data.frame':       1307472 obs. of  2 variables:
#   ..$ site: chr [1:1307472] "NW_026622908.1_14228" "NW_026622908.1_14246" "NW_026622908.1_16651" "NW_026622908.1_16825" ...
# ..$ rate: num [1:1307472] 83.3 100 33.3 40 100 ...
# $ BH_CM24 :'data.frame':       1224278 obs. of  2 variables:
#   ..$ site: chr [1:1224278] "NW_026622963.1_22952" "NW_026622963.1_23843" "NW_026622963.1_24095" "NW_026622963.1_24202" ...
# ..$ rate: num [1:1224278] 100 100 84.6 83.3 16.7 ...
# $ BH_CM25 :'data.frame':       2249468 obs. of  2 variables:
#   ..$ site: chr [1:2249468] "NW_026622963.1_19146" "NW_026622963.1_19162" "NW_026622963.1_19197" "NW_026622963.1_19294" ...
# ..$ rate: num [1:2249468] 100 100 100 100 88.9 ...
# $ BH_CM26 :'data.frame':       1898985 obs. of  2 variables:
#   ..$ site: chr [1:1898985] "NW_026622819.1_50711" "NW_026622819.1_50712" "NW_026622819.1_50721" "NW_026622819.1_50722" ...
# ..$ rate: num [1:1898985] 87.5 14.3 100 100 100 ...
# $ BH_CM27 :'data.frame':       2008055 obs. of  2 variables:
#   ..$ site: chr [1:2008055] "NC_079873.1_15225" "NC_079873.1_22624" "NC_079873.1_22628" "NC_079873.1_22638" ...
# ..$ rate: num [1:2008055] 71.4 90.9 81.8 90.9 90.9 ...
# $ BH_CM28 :'data.frame':       2413429 obs. of  2 variables:
#   ..$ site: chr [1:2413429] "NW_026622863.1_7144" "NW_026622863.1_7162" "NW_026622863.1_7174" "NW_026622863.1_7251" ...
# ..$ rate: num [1:2413429] 80 80 18.2 89.7 82.8 ...
# $ BH_CM29 :'data.frame':       2031778 obs. of  2 variables:
#   ..$ site: chr [1:2031778] "NW_026622797.1_26179" "NW_026622797.1_26204" "NW_026622797.1_26231" "NW_026622797.1_36646" ...
# ..$ rate: num [1:2031778] 20 100 100 50 50 ...
# $ BH_CM30 :'data.frame':       1829761 obs. of  2 variables:
#   ..$ site: chr [1:1829761] "NW_026623089.1_553" "NW_026623089.1_581" "NW_026623089.1_586" "NW_026623089.1_593" ...
# ..$ rate: num [1:1829761] 100 100 100 91.7 83.3 ...
# $ BH_CM31 :'data.frame':       2024294 obs. of  2 variables:
#   ..$ site: chr [1:2024294] "NW_026622819.1_47105" "NW_026622819.1_47128" "NW_026622819.1_47130" "NW_026622819.1_47151" ...
# ..$ rate: num [1:2024294] 60 100 100 100 40 ...
# $ BH_CM32 :'data.frame':       2233466 obs. of  2 variables:
#   ..$ site: chr [1:2233466] "NW_026622874.1_11763" "NW_026622874.1_11809" "NW_026622874.1_11810" "NW_026622874.1_11895" ...
# ..$ rate: num [1:2233466] 82.6 83.3 66.7 66.7 95.5 ...
# $ BH_CM33 :'data.frame':       2239449 obs. of  2 variables:
#   ..$ site: chr [1:2239449] "NW_026623030.1_4695" "NW_026623030.1_4801" "NW_026623030.1_4819" "NW_026623030.1_5248" ...
# ..$ rate: num [1:2239449] 75 58.33 63.64 100 3.33 ...
# $ BH_CM34 :'data.frame':       1777220 obs. of  2 variables:
#   ..$ site: chr [1:1777220] "NW_026622841.1_19833" "NW_026622841.1_19846" "NW_026622841.1_20274" "NW_026622841.1_20354" ...
# ..$ rate: num [1:1777220] 100 75 93.3 86.7 0 ...
# $ BH_CM35 :'data.frame':       2228679 obs. of  2 variables:
#   ..$ site: chr [1:2228679] "NW_026622952.1_767" "NW_026622952.1_773" "NW_026622952.1_787" "NW_026622952.1_798" ...
# ..$ rate: num [1:2228679] 85.7 100 100 100 100 ...
# $ BH_CM36 :'data.frame':       1397082 obs. of  2 variables:
#   ..$ site: chr [1:1397082] "NW_026622808.1_13097" "NW_026622808.1_13108" "NW_026622808.1_13112" "NW_026622808.1_13141" ...
# ..$ rate: num [1:1397082] 76.9 88.5 80.8 88.5 100 ...
# $ BH_CM37 :'data.frame':       1899851 obs. of  2 variables:
#   ..$ site: chr [1:1899851] "NW_026622763.1_3067" "NW_026622763.1_3090" "NW_026622763.1_3091" "NW_026622763.1_3094" ...
# ..$ rate: num [1:1899851] 91.5 93.3 100 100 100 ...
# $ BH_CM38 :'data.frame':       2213279 obs. of  2 variables:
#   ..$ site: chr [1:2213279] "NW_026622985.1_970" "NW_026622985.1_991" "NW_026622985.1_1112" "NW_026622985.1_1115" ...
# ..$ rate: num [1:2213279] 67.4 23.3 98.8 100 93 ...
# $ BH_CM39 :'data.frame':       1773208 obs. of  2 variables:
#   ..$ site: chr [1:1773208] "NW_026622863.1_7174" "NW_026622863.1_7251" "NW_026622863.1_7256" "NW_026622863.1_7294" ...
# ..$ rate: num [1:1773208] 60 68.8 75 50 100 ...
# $ BH_CM40 :'data.frame':       2054625 obs. of  2 variables:
#   ..$ site: chr [1:2054625] "NW_026623008.1_36355" "NW_026623008.1_37348" "NW_026623008.1_37371" "NW_026623008.1_37373" ...
# ..$ rate: num [1:2054625] 100 50 100 50 87.5 50 87.5 87.5 100 80 ...
# $ BH_CM41 :'data.frame':       1892128 obs. of  2 variables:
#   ..$ site: chr [1:1892128] "NW_026622874.1_10165" "NW_026622874.1_11763" "NW_026622874.1_11809" "NW_026622874.1_25023" ...
# ..$ rate: num [1:1892128] 0 93.3 73.3 55.6 100 ...
# $ BH_CM42 :'data.frame':       1844684 obs. of  2 variables:
#   ..$ site: chr [1:1844684] "NW_026622908.1_14228" "NW_026622908.1_14246" "NW_026622908.1_14256" "NW_026622908.1_14270" ...
# ..$ rate: num [1:1844684] 40 100 100 60 30.8 ...
# $ BH_CM43 :'data.frame':       1761882 obs. of  2 variables:
#   ..$ site: chr [1:1761882] "NW_026622863.1_7174" "NW_026622863.1_7251" "NW_026622863.1_7256" "NW_026622863.1_7294" ...
# ..$ rate: num [1:1761882] 75 80 60 42.9 86.7 ...
# $ BH_CM44 :'data.frame':       2460852 obs. of  2 variables:
#   ..$ site: chr [1:2460852] "NW_026622775.1_11878" "NW_026622775.1_11884" "NW_026622775.1_11885" "NW_026622775.1_11890" ...
# ..$ rate: num [1:2460852] 92.3 100 88.9 75 100 ...
# $ BH_CM45 :'data.frame':       1941215 obs. of  2 variables:
#   ..$ site: chr [1:1941215] "NW_026622986.1_44534" "NW_026622986.1_44561" "NW_026622986.1_44582" "NW_026622986.1_44593" ...
# ..$ rate: num [1:1941215] 80 60 80 80 20 ...
# $ BH_CM46 :'data.frame':       1833636 obs. of  2 variables:
#   ..$ site: chr [1:1833636] "NW_026622897.1_3734" "NW_026622897.1_3757" "NW_026622897.1_3777" "NW_026622897.1_3792" ...
# ..$ rate: num [1:1833636] 100 100 100 100 66.7 ...
# $ BH_CM47 :'data.frame':       1732999 obs. of  2 variables:
#   ..$ site: chr [1:1732999] "NW_026623008.1_37348" "NW_026623008.1_37371" "NW_026623008.1_37373" "NW_026623008.1_37394" ...
# ..$ rate: num [1:1732999] 100 100 100 57.1 78.6 ...
# $ BH_CM48 :'data.frame':       1164452 obs. of  2 variables:
#   ..$ site: chr [1:1164452] "NW_026622808.1_13097" "NW_026622808.1_13108" "NW_026622808.1_13111" "NW_026622808.1_13112" ...
# ..$ rate: num [1:1164452] 76.2 100 40 76.2 100 ...
# $ BH_CM49 :'data.frame':       1730628 obs. of  2 variables:
#   ..$ site: chr [1:1730628] "NW_026622963.1_19146" "NW_026622963.1_19162" "NW_026622963.1_19197" "NW_026622963.1_19294" ...
# ..$ rate: num [1:1730628] 100 100 100 100 100 100 100 100 100 100 ...
# $ BH_CM50 :'data.frame':       1701262 obs. of  2 variables:
#   ..$ site: chr [1:1701262] "NW_026622874.1_11763" "NW_026622874.1_11809" "NW_026622874.1_23156" "NW_026622874.1_23190" ...
# ..$ rate: num [1:1701262] 86.4 86.4 100 100 16.7 ...
# $ BH_CM51 :'data.frame':       2488191 obs. of  2 variables:
#   ..$ site: chr [1:2488191] "NW_026622875.1_19231" "NW_026622875.1_19240" "NW_026622875.1_19241" "NW_026622875.1_19283" ...
# ..$ rate: num [1:2488191] 100 100 85.1 100 87.5 ...
# $ BH_CM52 :'data.frame':       2365890 obs. of  2 variables:
#   ..$ site: chr [1:2365890] "NW_026623078.1_3372" "NW_026623078.1_3378" "NW_026623078.1_3396" "NW_026623078.1_3408" ...
# ..$ rate: num [1:2365890] 100 100 100 100 100 ...
# $ BH_CM53 :'data.frame':       2292673 obs. of  2 variables:
#   ..$ site: chr [1:2292673] "NW_026623008.1_37348" "NW_026623008.1_37371" "NW_026623008.1_37373" "NW_026623008.1_37394" ...
# ..$ rate: num [1:2292673] 66.7 66.7 77.8 77.8 55.6 ...
# $ BH_CM54 :'data.frame':       2014305 obs. of  2 variables:
#   ..$ site: chr [1:2014305] "NW_026622852.1_6951" "NW_026622852.1_6978" "NW_026622852.1_6987" "NW_026622852.1_7724" ...
# ..$ rate: num [1:2014305] 100 80 100 100 100 100 100 100 80 87.5 ...
# $ BH_CM55 :'data.frame':       2267266 obs. of  2 variables:
#   ..$ site: chr [1:2267266] "NC_079873.1_14422" "NC_079873.1_14423" "NC_079873.1_14426" "NC_079873.1_14427" ...
# ..$ rate: num [1:2267266] 60 100 100 100 100 ...
# $ BH_CM56 :'data.frame':       2166157 obs. of  2 variables:
#   ..$ site: chr [1:2166157] "NW_026622986.1_44534" "NW_026622986.1_44561" "NW_026622986.1_44582" "NW_026622986.1_44593" ...
# ..$ rate: num [1:2166157] 100 100 100 100 0 100 0 0 40 60 ...
# $ BH_CM57 :'data.frame':       1503325 obs. of  2 variables:
#   ..$ site: chr [1:1503325] "NW_026622863.1_2595" "NW_026622863.1_7251" "NW_026622863.1_7256" "NW_026622863.1_58530" ...
# ..$ rate: num [1:1503325] 66.7 83.3 50 40 100 ...
# $ BH_CM58 :'data.frame':       1712681 obs. of  2 variables:
#   ..$ site: chr [1:1712681] "NW_026622819.1_47105" "NW_026622819.1_47128" "NW_026622819.1_47130" "NW_026622819.1_47151" ...
# ..$ rate: num [1:1712681] 100 100 100 88.9 55.6 ...
# $ BH_CM59 :'data.frame':       2067926 obs. of  2 variables:
#   ..$ site: chr [1:2067926] "NW_026622852.1_7594" "NW_026622852.1_7615" "NW_026622852.1_7724" "NW_026622852.1_7735" ...
# ..$ rate: num [1:2067926] 100 36.4 100 100 90.9 ...
# $ BH_CM60 :'data.frame':       1675018 obs. of  2 variables:
#   ..$ site: chr [1:1675018] "NW_026622852.1_6951" "NW_026622852.1_6978" "NW_026622852.1_6987" "NW_026622852.1_7594" ...
# ..$ rate: num [1:1675018] 100 100 85.7 100 30 ...
# $ BH_CM61 :'data.frame':       2411580 obs. of  2 variables:
#   ..$ site: chr [1:2411580] "NW_026622763.1_886" "NW_026622763.1_909" "NW_026622763.1_910" "NW_026622763.1_913" ...
# ..$ rate: num [1:2411580] 100 100 83.3 100 100 ...
# $ BH_CM62 :'data.frame':       2233533 obs. of  2 variables:
#   ..$ site: chr [1:2233533] "NW_026622875.1_19231" "NW_026622875.1_19240" "NW_026622875.1_19241" "NW_026622875.1_19283" ...
# ..$ rate: num [1:2233533] 80 100 100 80 100 ...
# $ BH_CM63 :'data.frame':       1981448 obs. of  2 variables:
#   ..$ site: chr [1:1981448] "NW_026622808.1_12818" "NW_026622808.1_12827" "NW_026622808.1_12832" "NW_026622808.1_12969" ...
# ..$ rate: num [1:1981448] 75 87.5 100 100 100 ...
# $ BH_CM64 :'data.frame':       2738554 obs. of  2 variables:
#   ..$ site: chr [1:2738554] "NW_026622763.1_279" "NW_026622763.1_295" "NW_026622763.1_310" "NW_026622763.1_330" ...
# ..$ rate: num [1:2738554] 0 40 90.9 83.3 100 ...
# $ BH_CM65 :'data.frame':       1567565 obs. of  2 variables:
#   ..$ site: chr [1:1567565] "NW_026622985.1_970" "NW_026622985.1_991" "NW_026622985.1_1112" "NW_026622985.1_1115" ...
# ..$ rate: num [1:1567565] 50 0 100 100 100 ...
# $ BH_CM66 :'data.frame':       1942304 obs. of  2 variables:
#   ..$ site: chr [1:1942304] "NW_026622952.1_738" "NW_026622952.1_747" "NW_026622952.1_750" "NW_026622952.1_767" ...
# ..$ rate: num [1:1942304] 100 90 60 100 100 90 80 100 80 80 ...
# $ BH_CM67 :'data.frame':       2681281 obs. of  2 variables:
#   ..$ site: chr [1:2681281] "NW_026623111.1_2454" "NW_026623111.1_36754" "NW_026623111.1_36773" "NW_026623111.1_38224" ...
# ..$ rate: num [1:2681281] 88.4 60 20 54.5 30 ...
# $ BH_CM68 :'data.frame':       2194698 obs. of  2 variables:
#   ..$ site: chr [1:2194698] "NW_026623061.1_11689" "NW_026623061.1_11809" "NW_026623061.1_11812" "NW_026623061.1_11819" ...
# ..$ rate: num [1:2194698] 14 97.7 77.3 91.1 93.3 ...
# $ BH_CM69 :'data.frame':       2468199 obs. of  2 variables:
#   ..$ site: chr [1:2468199] "NW_026622886.1_568" "NW_026622886.1_571" "NW_026622886.1_643" "NW_026622886.1_839" ...
# ..$ rate: num [1:2468199] 90.9 100 0 100 100 ...
# $ BH_CM70 :'data.frame':       2435771 obs. of  2 variables:
#   ..$ site: chr [1:2435771] "NW_026622952.1_116" "NW_026622952.1_119" "NW_026622952.1_134" "NW_026622952.1_142" ...
# ..$ rate: num [1:2435771] 100 100 80 100 20 ...
# $ BH_CM71 :'data.frame':       2314723 obs. of  2 variables:
#   ..$ site: chr [1:2314723] "NW_026622841.1_19833" "NW_026622841.1_19846" "NW_026622841.1_20274" "NW_026622841.1_20354" ...
# ..$ rate: num [1:2314723] 100 85.7 88.9 77.8 14.3 ...
# $ BH_CM72 :'data.frame':       1277241 obs. of  2 variables:
#   ..$ site: chr [1:1277241] "NW_026622919.1_52183" "NW_026622919.1_52201" "NW_026622919.1_52216" "NW_026622919.1_52237" ...
# ..$ rate: num [1:1277241] 100 100 100 100 100 ...
# $ BH_CM73 :'data.frame':       1532747 obs. of  2 variables:
#   ..$ site: chr [1:1532747] "NW_026622908.1_15824" "NW_026622908.1_15835" "NW_026622908.1_15838" "NW_026622908.1_15845" ...
# ..$ rate: num [1:1532747] 71.4 100 100 100 100 ...
# $ BH_CM74 :'data.frame':       1328673 obs. of  2 variables:
#   ..$ site: chr [1:1328673] "NW_026623056.1_375" "NW_026623056.1_396" "NW_026623056.1_516" "NW_026623056.1_519" ...
# ..$ rate: num [1:1328673] 100 20 100 100 100 ...
# $ BH_CM75 :'data.frame':       2044160 obs. of  2 variables:
#   ..$ site: chr [1:2044160] "NW_026623008.1_37348" "NW_026623008.1_37371" "NW_026623008.1_37373" "NW_026623008.1_37394" ...
# ..$ rate: num [1:2044160] 50 100 100 75 50 ...
# $ BH_CM76 :'data.frame':       1914730 obs. of  2 variables:
#   ..$ site: chr [1:1914730] "NW_026623008.1_37348" "NW_026623008.1_37371" "NW_026623008.1_37373" "NW_026623008.1_37394" ...
# ..$ rate: num [1:1914730] 44.4 100 55.6 22.2 22.2 ...
# $ BH_CM77 :'data.frame':       1851382 obs. of  2 variables:
#   ..$ site: chr [1:1851382] "NW_026622763.1_910" "NW_026622763.1_914" "NW_026622763.1_925" "NW_026622763.1_931" ...
# ..$ rate: num [1:1851382] 73.3 75 50 87.5 62.5 ...
# $ BH_CM78 :'data.frame':       2535866 obs. of  2 variables:
#   ..$ site: chr [1:2535866] "NW_026623030.1_3398" "NW_026623030.1_3431" "NW_026623030.1_4695" "NW_026623030.1_4801" ...
# ..$ rate: num [1:2535866] 14.3 85.7 83.3 65 75 ...
# [list output truncated]

## 3. 年齢データを読み込む → 例：age_data
age_data <- read.csv("sample_ages_H_BB.csv")  # "sample" 列と "age" 列が必要

## 4. サンプル名で age 情報と対応させて、CpGごとの相関計算
# site列を行名に
meth_mat <- as.data.frame(meth_merged)
rownames(meth_mat) <- meth_mat$site
meth_mat <- meth_mat[ , -1]

# サンプル名を揃える
meth_mat <- meth_mat[, age_data$sample]  # 並び替え注意、sample_ageファイルの順番に並び替えられる

#ここまで理解


# 相関とp値を計算
cor_results <- apply(meth_mat, 1, function(row) {
  valid <- !is.na(row) & !is.na(age_data$age)  # 両方NAでない位置だけ抽出
  if (sum(valid) >=  5) {  # 有効なデータ点が5つ以上あるか確認 chatGRTは5推奨
    test <- suppressWarnings(cor.test(as.numeric(row[valid]), age_data$ age[valid], method = "pearson"))
    c(cor = test$estimate, p = test$p.value)
  } else {
    c(cor = NA, p = NA)
  }
})


cor_df <- as.data.frame(t(cor_results))
colnames(cor_df)[1:2] <- c("cor", "p")   # V1 -> cor, V2 -> p
cor_df$site <- rownames(cor_df )　#cor_dfはmeth_mat でもOK
rownames(cor_df) <- NULL  # 行名は消しておく（必要に応じて）

head(cor_df)
# cor          p              site
# 1  0.33300044 0.04401706 NC_003427.1_10003
# 2  0.15138435 0.17457880 NC_003427.1_10004
# 3 -0.08457216 0.57628909 NC_003427.1_10026
# 4  0.02717505 0.79930366 NC_003427.1_10027
# 5 -0.06417044 0.56925807 NC_003427.1_10095
# 6  0.20017391 0.04931338 NC_003427.1_10096

dim(cor_df)  # 行数と列数を確認
# [1] 8938086       3

## 5. FDR補正 → q値を計算（p.adjust() 使用）
cor_df$q <- p.adjust(cor_df$p, method = "fdr")

head(cor_df)
# cor          p              site         q
# 1  0.33300044 0.04401706 NC_003427.1_10003 0.7398640
# 2  0.15138435 0.17457880 NC_003427.1_10004 0.8862256
# 3 -0.08457216 0.57628909 NC_003427.1_10026 0.9404386
# 4  0.02717505 0.79930366 NC_003427.1_10027 0.9757805
# 5 -0.06417044 0.56925807 NC_003427.1_10095 0.9392559
# 6  0.20017391 0.04931338 NC_003427.1_10096 0.7556113

dim(cor_df)
# [1] 8938086       4

## 6. 結果をフィルタして age-related CpG を抽出
age_related <- subset(cor_df, q < 0.05)

head(age_related)
# cor            p                  site           q
# 2282  0.6177131 1.372729e-06  NC_079873.1_10105766 0.017362276
# 5678  0.4459463 6.652597e-06 NC_079873.1_102701098 0.040611589
# 40952 0.4371915 8.438522e-06 NC_079873.1_116607726 0.045269870
# 40962 0.4430920 6.158457e-06 NC_079873.1_116607751 0.038960516
# 41273 0.5493561 2.979575e-08 NC_079873.1_116691082 0.001594725
# 58535 0.4647573 4.469402e-06 NC_079873.1_120275950 0.033392530

dim(age_related)
## 6. 結果をフィルタして age-related CpG を抽出
age_related <- subset(cor_df, q < 0.05)

head(age_related)
# cor            p                  site           q
# 2282  0.6177131 1.372729e-06  NC_079873.1_10105766 0.017362276
# 5678  0.4459463 6.652597e-06 NC_079873.1_102701098 0.040611589
# 40952 0.4371915 8.438522e-06 NC_079873.1_116607726 0.045269870
# 40962 0.4430920 6.158457e-06 NC_079873.1_116607751 0.038960516
# 41273 0.5493561 2.979575e-08 NC_079873.1_116691082 0.001594725
# 58535 0.4647573 4.469402e-06 NC_079873.1_120275950 0.033392530

dim(age_related)
# [1] 934   4


##結果の保存（任意）
write.table(age_related, file = "age_related_CpGs.tsv", sep = "\t", row.names = FALSE, quote = FALSE)

#ここから図示
##CpGサイト "NC_XXXX_XXXX" のメチル化率と年齢の散布図を描く
install.packages("ggplot2")
library(ggplot2)

# 例として CpGサイト名を変数に
target_site <- "NW_026622919.1_17907683"

# meth_matは行がCpGサイト、列がサンプルのメチル化率データフレーム
# age_dataは "sample" と "age" 列を持つデータフレーム

# 対象のCpGサイトのメチル化率ベクトルを抽出
meth_values <- as.numeric(meth_mat[target_site, ])

# 年齢とメチル化率のデータフレームを作成
plot_data <- data.frame(
  age = age_data$age,
  methylation = meth_values
)

# NAを含む行は除外
plot_data <- na.omit(plot_data)

# 散布図と相関係数を表示
p <- ggplot(plot_data, aes(x = age, y = methylation)) +
  geom_point(color = "blue", alpha = 0.6) +
  geom_smooth(method = "lm", se = TRUE, color = "red") +  # 回帰直線
  labs(title = paste(target_site),
       x = "age (year)",
       y = "methylation level (%)") +
  theme_minimal()


ggsave(filename = paste0(target_site, ".pdf"),
       plot = p,
       width = 6,
       height = 4)

#動かない、未解決
ggsave(filename = paste0(target_site, ".png"), plot = p, width = 6, height = 4, dpi = 300) 

#いろいろな図はord fileにあり

# 補足 by chat GPT
# •	q値 は p値 に FDR補正をかけたもの。q < 0.05 は「FDR 5%で有意」と解釈します。
# •	p.adjust(method = "fdr") は Benjamini-Hochberg 法（一般的なFDR補正）です。
# •	CpGが多い場合、相関計算やmergeは時間がかかります。
# •	もし CpGのクロモソーム情報・ゲノム位置に戻したい場合、site列を strsplit() で分割して chr と pos を取り出せます。



